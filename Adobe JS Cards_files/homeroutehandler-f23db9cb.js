(window.webpackJsonp=window.webpackJsonp||[]).push([["homeroutehandler"],{3364:function(e,t,a){var r=a(3365);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};a(298)(r,n);r.locals&&(e.exports=r.locals)},3365:function(e,t,a){(e.exports=a(297)(!1)).push([e.i,".vqa-render-modal-div{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center}.vqa-render-modal-status-div{padding-top:20px}",""])},3592:function(e,t,a){"use strict";a.r(t);var r,n=a(21),o=a.n(n),s=a(73),i=a.n(s),l=a(4),d=a.n(l),u=a(3),c=a.n(u),p=a(29),h=a.n(p),m=a(28),f=a.n(m),w=a(30),g=a.n(w),v=a(0),y=a.n(v),S=a(99),E=a(605),b=a(202),k=a.n(b),D=a(17),C=a.n(D),A=a(8),U=a.n(A),R=a(1538),L=a.n(R);!function(e){e.UNKNOWN="UNKNOWN",e.QUEUED="QUEUED",e.ACTIVE="ACTIVE",e.DISCARDED="DISCARDED",e.SUCCESS="SUCCESS",e.FAILED="FAILED",e.DELETED="DELETED",e.CANCELLED="CANCELLED"}(r||(r={}));var x=r,_=(a(3364),function(e){function t(e){var a;return d()(this,t),(a=h()(this,f()(t).call(this,e))).state={status:x.UNKNOWN,progress:0,cancelRequested:!1,completed:!1,outputURL:null,renderedFileSize:0},a}var a,r;return g()(t,e),c()(t,[{key:"checkStatusOnce",value:(r=i()(o.a.mark((function e(){var t,a,r,n,s,i,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.props.getRenderJobStatus(this.props.jobId);case 3:a=e.sent,t=a,e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),t=void 0,window.marvel.logger.error("Error getting render job status for VQA auto downloading",e.t0);case 11:if(void 0!==t){e.next=15;break}return this.setState({status:x.FAILED}),window.marvel.logger.error("Render job failed for VQA auto downloading, job Id",this.props.jobId),e.abrupt("return");case 15:r=t.progress,n=Number(r.substring(0,r.length-1)),s=t.status,i=t.status===x.SUCCESS?t.output.output_location[0].path:null,l=t.status===x.SUCCESS?t.output.output_size_mb:0,this.setState({progress:n,status:s,outputURL:i,renderedFileSize:l});case 21:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return r.apply(this,arguments)})},{key:"completed",value:function(){return[x.CANCELLED,x.DELETED,x.DISCARDED,x.FAILED,x.SUCCESS].includes(this.state.status)}},{key:"monitorRenderJob",value:(a=i()(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkStatusOnce();case 2:if(this.state.cancelRequested&&this.setState({status:x.CANCELLED}),!this.completed()){e.next=6;break}return this.state.status!==x.CANCELLED&&this.props.completionCallBack(this.state.outputURL,this.state.renderedFileSize),e.abrupt("return");case 6:setTimeout(i()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.monitorRenderJob();case 2:case"end":return e.stop()}}),e)}))),2e3);case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"cancelJob",value:function(){this.setState({cancelRequested:!0}),this.props.completionCallBack(this.state.outputURL,this.state.renderedFileSize)}},{key:"componentDidMount",value:function(){this.monitorRenderJob()}},{key:"render",value:function(){var e=this;return y.a.createElement("div",{className:"mrvl-overlay-overlay-bg save-in-progress-overlay-bg"},y.a.createElement(E.SparkDialog,{open:!0,mode:"empty",hideCloseButton:!0,className:"vqa-render-modal-div"},y.a.createElement("span",{class:"spectrum-Heading"},C.a.formatMessage("vqa-auto-downloading-title")),y.a.createElement("div",{class:"vqa-render-modal-status-div"},y.a.createElement(L.a,{id:"rendering-progress-bar",formatOptions:{style:"percent",minimumFractionDigits:0},value:this.state.progress,isIndeterminate:[x.UNKNOWN,x.QUEUED].includes(this.state.status),showValueLabel:!0,size:"M",showPercent:!0})),y.a.createElement(k.a,{className:"spark-dialog-close-button",variant:"action",onClick:function(){e.cancelJob()}})))}}]),t}(y.a.Component));_.PropTypes={jobId:U.a.string.isRequired,getRenderJobStatus:U.a.func.isRequired,completionCallBack:U.a.func.isRequired};t.default=Object(S.injectIntl)(_)},3715:function(e,t,a){"use strict";a.r(t);var r=a(21),n=a.n(r),o=a(73),s=a.n(o),i=a(4),l=a.n(i),d=a(3),u=a.n(d),c=a(2),p=a.n(c),h=a(35),m=a.n(h),f=a(38),w=a.n(f),g=a(205),v=a.n(g),y=a(172),S=a.n(y),E=a(2812),b=(a(2083),a(43)),k=a(947),D=a.n(k),C=(a(17),a(32)),A=a.n(C),U=a(4603),R=a.n(U),L=a(13),x=a.n(L),_=a(1),N=a.n(_),j=a(22),F=a.n(j),I=a(606),q=a(3592),P=new(function(){function e(){l()(this,e)}var t;return u()(e,[{key:"submitRenderJob",value:function(e){var t=p.a.defer(),a=new R.a,r=JSON.parse(window.sessionStorage.getItem(N.a.vqaAutoDownloadSessionStorageKey));null!=r&&r.request_headers&&delete r.request_headers["X-Anonymous-Auth"];var n=null==r?void 0:r.request_headers;return a.append("project_payload",e.project_payload),a.append("preset_info",e.preset_info),x.a.ajax({type:"POST",url:N.a.transientUserServiceEndpoint+"/render/submit",data:a,contentType:!1,processData:!1,headers:A()({"x-api-key":N.a.ccLightTransientUserAPIKey,"x-request-id":F()()},n),success:function(e){t.resolve(e)},error:function(e){window.marvel.logger.error("Error submitting render job for VQA auto downloading",e),t.reject(e||"transient service render submit error")}}),t.promise}},{key:"getRenderJobStatus",value:function(e){var t=p.a.defer(),a=JSON.parse(window.sessionStorage.getItem(N.a.vqaAutoDownloadSessionStorageKey));null!=a&&a.request_headers&&delete a.request_headers["X-Anonymous-Auth"];var r=null==a?void 0:a.request_headers;return x.a.ajax({type:"GET",url:N.a.transientUserServiceEndpoint+"/render/"+e,contentType:"application/json",headers:A()({"x-api-key":N.a.ccLightTransientUserAPIKey,"x-request-id":F()()},r),success:function(e){t.resolve(e)},error:function(e){window.marvel.logger.error("Error getting render job status for VQA auto downloading",e),t.reject(e||"transient service render status error")}}),t.promise}},{key:"completionCallback",value:function(e,t){if(document.getElementById("vqaCloudRenderModalCCXHome").remove(),e){w.a.trackEvent("project:exportCompleted",A()({},JSON.parse(window.sessionStorage.getItem(N.a.vqaAutoDownloadSessionStorageKey)).analyticsData,{contextualData6:"fileSize:".concat(t)}));var a=document.createElement("a");a.href=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),E.default.handleProjectsRenderHelper({selectedPane:"home",renderAllQuickActionsModal:!0,autoVQADownloadOptions:{autoVQADownloadUrl:e}})}else window.marvel.navigate("/",{trigger:!0})}},{key:"renderVQAAutoDownloadModal",value:(t=s()(n.a.mark((function e(){var t,a,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=JSON.parse(window.sessionStorage.getItem(N.a.vqaAutoDownloadSessionStorageKey))){e.next=4;break}return window.marvel.logger.error("Error getting render job details session data for VQA auto downloading"),e.abrupt("return");case 4:return window.sessionStorage.removeItem("qtnavdata"),e.next=7,this.submitRenderJob(t.request_body);case 7:a=e.sent,(r=document.createElement("div")).classList.add("associated-brand-missing-overlay"),r.classList.add("spectrum"),r.classList.add("spectrum--light"),r.setAttribute("id","vqaCloudRenderModalCCXHome"),document.body.appendChild(r),new(I.default.wrapComponent(q.default))({el:r,modelJSON:{jobId:a.job_id,getRenderJobStatus:this.getRenderJobStatus,completionCallBack:this.completionCallback}}).render();case 17:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}()),J=a(764),O=a.n(J),M=function(){function e(){l()(this,e),b.default.on("mrvl-must-reload",this._handleMustReload.bind(this)),this._initializeDetectionOfBackButtonClickWhileLoadingEditor()}var t;return u()(e,[{key:"_initializeDetectionOfBackButtonClickWhileLoadingEditor",value:function(){var e=this;window.addEventListener("popstate",(function(){e._backButtonClicked=!0})),b.default.on("editor-invoked",(function(){e._editorIsLoading=!0})),b.default.on("hide-interstitial",(function(){e._editorIsLoading=!1}))}},{key:"_handleHome",value:function(){S.a.load().then((function(e){var t=new e.SparkFolderDiscoverySpec;b.default.trigger("set-sync-mode",{mode:"sync-home",folderSpec:t,previousFolderCallback:function(e){E.default.handleProjectsRenderHelper({selectedPane:"home",previousFolderSpec:e}),v.a.run("massiveSearchAtHome*").catch((function(e){window.marvel.logger.error("Error loading experiment data for massiveSearchAtHome: ",e)})).done()}})}))}},{key:"startVQADownload",value:(t=s()(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P.renderVQAAutoDownloadModal();case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"handleHome",value:function(){var e=this;D.a.shouldForcePersonalizerOnCCX().then((function(t){var a=m.a.hasFeature("has-seen-or-skipped-personalizer-onboarding"),r=!1;new URLSearchParams(window.location.search).get("autoDownloadVQA")&&(r=!0,e.startVQADownload());var n=m.a.hasFeature("is-paid-user");if(!window.adobeIMS.isSignedInUser()||n||m.a.isNewUser())!t||a||r?m.a.hasFeature("created-first-project")?e._handleHome():S.a.load().then((function(t){return t.ACPSparkController.getAllProjectsCount().then((function(t){var a=window.marvel&&window.marvel._firstLaunchSession;if(t>0)m.a.setUserFlag("created-first-project",!0);else if(!a&&!m.a.hasAny("user-has-seen-npw-onboarding","force-skipped-npw-onboarding")&&!r)return void window.marvel.navigate("onboarding",{trigger:!0,replace:!0});e._handleHome()}))})).catch((function(t){window.marvel.logger.error("exception counting projects",{error:t}),e._handleHome()})):window.marvel.navigate("onboarding",{trigger:!0,replace:!0});else if(e._handleHome(),m.a.hasFeature("show-paywall-return")&&!m.a.hasFeature("paywall-shown-after-day-28")){v.a.run("additionalReturnPaywallAppearancesExperiment*").catch((function(e){window.marvel.logger.error("Error loading experiment data for premiumRecommendationAfter1stExportExperiment",e)})).done(),m.a.hasFeature("paywall-shown-after-day-1")||(m.a.setUserFlag("paywall-shown-after-day-1",!0),m.a.setUserProperty("paywallDay",0));var o=(new Date).getTime()-m.a.getUserData("createTime");o/=864e5,o=Math.floor(o),-1!==[1,2,4,7,10,13,16,19,22,25,28].indexOf(o)&&m.a.getUserProperty("paywallDay")<o&&(O.a.showMerchMessagingModal({analyticsTrigger:"homeReturnAfterDay1",workflow:"appNavUpgrade"}),m.a.setUserProperty("paywallDay",o)),o>=28&&m.a.setUserFlag("paywall-shown-after-day-28",!0)}else m.a.hasFeature("paywall-shown-after-day-1")||(m.a.setUserFlag("paywall-shown-after-day-1",!0),O.a.showMerchMessagingModal({analyticsTrigger:"homeReturnAfterDay1",workflow:"appNavUpgrade"}))})).catch((function(t){window.marvel.logger.warn("uncaught exception in handleHome while checking personalizer onboarding",{error:t}),e._handleHome()}))}},{key:"_handleMustReload",value:function(e){var t=e.msg||"Unknown error, must refresh";e.goto;"USER_CANCELED"!==e.code&&window.alert(t),window.marvel.navigate("/projects"),setTimeout((function(){window.location.reload()}),1)}},{key:"interceptDefaultRoute",value:function(){return window.marvel._firstLaunchSession?m.a.hasFeature("first-launch-create-new")?(window.marvel.navigate("design/page/new",{trigger:!0}),p.a.resolve(!0)):m.a.hasFeature("first-launch-create-from-template")?(window.marvel.navigate("tmpl/page/wShgU",{trigger:!0}),p.a.resolve(!0)):p.a.resolve(!1):p.a.resolve(!1)}},{key:"processHome",value:function(){var e=this;return m.a.allFeaturesLoaded().then((function(){w.a.savePreProcessedSeoPagesVisited(),v.a.handleExperimentRedirect().finally((function(){e.interceptDefaultRoute().then((function(t){t||e.handleHome()})).done()})).done()}))}}]),e}();t.default=new M},4603:function(e,t){e.exports="object"==typeof self?self.FormData:window.FormData}}]);
//# sourceMappingURL=homeroutehandler-f23db9cb.js.map